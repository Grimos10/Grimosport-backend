# Backend Grimosport Project

Preamble: this is an university project for the "Tecnologie Web" (Web Technology) exam. The project is a web application for a sport shop. The project is divided in two parts: the backend and the frontend. This is the backend part. The frontend part is available at this [link](https://github.com/Grimos10/ecommerce-vue).

The course was about learning the basics of web development, so the project is not perfect and it's not complete, it's just a prototype.
Also was about learning Django, so I used Django and Django REST Framework to build the backend.

I decided, just for fun and not beacuse it was necessary, to deploy the project on a server that I manage with a friend of mine, https://grimosport.grimos.dev (API link).


## Dependencies and features

This project includes the following features:

- User authentication and authorization
- Product catalog with search and filtering functionality
- Shopping cart and checkout process
- Order management for both customers and administrators

And use the following dependencies:

- `django`
- `django-rest-framework`
- `django-cors-headers`: (for CORS)
- `djoser`: (for authentication)
- `pillow`: (for image processing)
- `django-environ`: (for environment variables)
- `stripe`: (for payments) see [stripe and payments](#stripe-and-payments) section for more details

## Documentation

### Authentication

I used Djoser to manage authentication. Djoser is a REST implementation of Django authentication system. It provides a set of endpoints to manage users authentication, registration, password reset, etc.

For the project I decided to use token authentication. Token authentication is a way to authenticate users based on a token that is sent in the request. The token is generated by the server and sent to the client, and the client sends it back to the server in subsequent requests. The token is sent in the `Authorization` header of the request.

### Handling images

I used Pillow to handle images. Pillow is a Python Imaging Library (PIL), it adds image processing capabilities to your Python interpreter.


### Stripe and payments

I used Stripe to manage payments. Stripe is a payment platform that allows you to accept payments online.
I want to specify that I didn't use Stripe because it was necessary, I used it just for fun and to learn something new.
In fact you can use the website without paying, you can just use the test card number `4242 4242 4242 4242` with any CVC, any future expiration date, and any postal code.
This allows you to test the payment process without using a real credit card and create a order so you can see it in your profile.

# API Documentation

The API exposes multiple HTTP routes.

The most important sections of the API are the following:

1. [Product](#product)
2. [Order](#order)

Both of these sections is implemented in a dedicated directory in the `backend_django` subdirectory.

## Product

Here is a table of contents with a few routes in this section:

1. [GET `/latest-products/`](#get-latest-products)
2. [GET `/stats/`](#get-stats)
3. [POST `/add-product/`](#post-add-product)


### GET `/latest-products/`

Get the 4 latest products added to the catalog.

Example output:

~~~
[
    {
        "id": 12,
        "name": "xsasds",
        "get_absolute_url": "/summer/safaf/",
        "description": "fsafasf",
        "price": "69.00",
        "get_image": "http://127.0.0.1:8000/media/uploads/pantaloncini_donna_estivi.jpg",
        "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/pantaloncini_donna_estivi.jpg",
        "category": 1
    },
    {
        "id": 10,
        "name": "Giubbino invernale running",
        "get_absolute_url": "/winter/giubbino-invernale-running/",
        "description": "Un giubbino arancione per la corsa che ti protegge dal freddo in inverno",
        "price": "99.00",
        "get_image": "http://127.0.0.1:8000/media/uploads/completo_invernale.jpg",
        "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/completo_invernale.jpg",
        "category": 2
    },
    {
        "id": 9,
        "name": "Completo sportivo donna",
        "get_absolute_url": "/summer/completo-sportivo-donna/",
        "description": "Un completo sportivo per uscire da donna per la stagione primaverile",
        "price": "99.00",
        "get_image": "http://127.0.0.1:8000/media/uploads/completo_donna_.jpg",
        "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/completo_donna_.jpg",
        "category": 1
    },
    {
        "id": 8,
        "name": "Completo palestra uomo",
        "get_absolute_url": "/winter/completo-palestra-uomo/",
        "description": "Completo per la palestra da uomo con anche una felpa per l'inverno",
        "price": "399.00",
        "get_image": "http://127.0.0.1:8000/media/uploads/palestra_uomo.jpg",
        "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/palestra_uomo.jpg",
        "category": 2
    }
]
~~~

### GET `/stats/`

This route takes a token in the `Authorization` header field and returns some statistics about the products in the catalog.

If the token is not provided or is invalid, the API returns a 401 status code with the following error message:

- `Authentication credentials were not provided` if the token is not provided

- `Invalid token` if the token is invalid

If the token is valid, the API returns a 200 status code and a JSON object listing the statistics of all the products.

Example output of the first 5 products in the list:

~~~
[
    {
        "id_product": 2,
        "name_product": "Felpa grigia uomo",
        "quantity_orders_product": 7,
        "quantity_orders": 4,
        "price_product": "99.00",
        "absolute_url_product": "/winter/felpa-grigia-uomo/"
    },
    {
        "id_product": 8,
        "name_product": "Completo palestra uomo",
        "quantity_orders_product": 7,
        "quantity_orders": 4,
        "price_product": "399.00",
        "absolute_url_product": "/winter/completo-palestra-uomo/"
    },
    {
        "id_product": 1,
        "name_product": "Completo invernale donna running",
        "quantity_orders_product": 4,
        "quantity_orders": 3,
        "price_product": "299.00",
        "absolute_url_product": "/winter/completo-invernale-donna-running/"
    },
    {
        "id_product": 10,
        "name_product": "Giubbino invernale running",
        "quantity_orders_product": 4,
        "quantity_orders": 4,
        "price_product": "99.00",
        "absolute_url_product": "/winter/giubbino-invernale-running/"
    },
    {
        "id_product": 3,
        "name_product": "Prova-vestito",
        "quantity_orders_product": 3,
        "quantity_orders": 3,
        "price_product": "99.00",
        "absolute_url_product": "/summer/prova/"
    },
]
~~~

### POST `/add-product/`

This route takes a token in the `Authorization` header field and a POST request body in `multipart/form-data` format containing the following fields:

- `name`: the name of the product
- `slug`: the slug of the product
- `description`: the description of the product
- `price`: the price of the product
- `category`: the category of the product
- `image`: the image of the product

You can expect the same error messages as the ones described in the [GET `/stats/`](#get-stats) section if the token is not provided or is invalid.

It returns a 201 status code if the product is successfully created, otherwise it returns a 400 status code with the following error message:

- `Bad request` if one of the fields is empty

## Order

Here is a table of contents with a few routes in this section:

1. [GET `/orders/`](#get-orders)
2. [POST `/checkout/`](#post-checkout)

### GET `/orders/`

This route takes a token in the `Authorization` header field and returns a list of all the orders placed by the user.

You can expect the same error messages as the ones described in the [GET `/stats/`](#get-stats) section if the token is not provided or is invalid.

Example output for a user with 2 orders:

~~~
[
    {
        "id": 10,
        "first_name": "sdasd",
        "last_name": "dsda",
        "email": "ddas@dsad.com",
        "address": "sdasd",
        "zipcode": "dsdas",
        "place": "adasd",
        "phone": "sdsadas",
        "stripe_token": "tok_1NuyNuBpXEnKYKYFaPgwdJvU",
        "items": [
            {
                "id": 14,
                "price": "99.00",
                "product": {
                    "id": 10,
                    "name": "Giubbino invernale running",
                    "get_absolute_url": "/winter/giubbino-invernale-running/",
                    "description": "Un giubbino arancione per la corsa che ti protegge dal freddo in inverno",
                    "price": "99.00",
                    "get_image": "http://127.0.0.1:8000/media/uploads/completo_invernale.jpg",
                    "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/completo_invernale.jpg",
                    "category": 2
                },
                "quantity": 1
            }
        ],
        "paid_amount": "99.00"
    },
    {
        "id": 9,
        "first_name": "dsad",
        "last_name": "dsadaw",
        "email": "dsdasd@dasdsad.com",
        "address": "dsdasd",
        "zipcode": "sfafa",
        "place": "dasda",
        "phone": "dsadas",
        "stripe_token": "tok_1NubXiBpXEnKYKYFusTTGfgi",
        "items": [
            {
                "id": 13,
                "price": "798.00",
                "product": {
                    "id": 8,
                    "name": "Completo palestra uomo",
                    "get_absolute_url": "/winter/completo-palestra-uomo/",
                    "description": "Completo per la palestra da uomo con anche una felpa per l'inverno",
                    "price": "399.00",
                    "get_image": "http://127.0.0.1:8000/media/uploads/palestra_uomo.jpg",
                    "get_thumbnail": "http://127.0.0.1:8000/media/uploads/uploads/palestra_uomo.jpg",
                    "category": 2
                },
                "quantity": 2
            }
        ],
        "paid_amount": "798.00"
    },
]
~~~

### POST `/checkout/`

This route takes a token in the `Authorization` header field and a POST request body in `application/json` format containing the following fields:

- `first_name`: the first name of the user
- `last_name`: the last name of the user
- `email`: the email of the user
- `address`: the address of the user
- `zipcode`: the zipcode of the user
- `place`: the place of the user
- `phone`: the phone of the user
- `stripe_token`: the stripe token of the user
- `items`: the items of the cart's user

You can expect the same error messages as the ones described in the [GET `/stats/`](#get-stats) section if the token is not provided or is invalid.

It returns a 201 status code if the order is successfully created, otherwise it returns a 400 status code with the following error message:

- `Bad request` if one of the fields is empty
